<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Renditerechner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#ffffff; --ink:#111827; --muted:#464b5a;
      --card:#ffffff; --border:rgba(17,24,39,.10);
      --shadow:0 18px 45px rgba(17,24,39,.10);
      --radius:16px;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--ink); }
    .wrap{ max-width:1100px; margin:0 auto; padding:26px 18px 48px; }
    h1{ margin:0 0 10px; font-size:22px; }
    p.lead{ margin:0 0 18px; color:var(--muted); line-height:1.5; max-width:980px; }
    .grid{ display:grid; grid-template-columns:1fr; gap:16px; }
    @media (min-width: 940px){ .grid{ grid-template-columns:1fr 1fr; } }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); }
    .sectionTitle{ margin:0 0 10px; font-size:15px; font-weight:900; }
    .twoCol{ display:grid; grid-template-columns:1fr; gap:12px; }
    @media (min-width: 720px){ .twoCol{ grid-template-columns:1fr 1fr; } }
    label{ font-size:13px; color:var(--muted); }
    input{
      width:100%; padding:11px 12px; border-radius:12px; border:1px solid rgba(17,24,39,.14);
      background:#fff; color:var(--ink); outline:none;
    }
    input:focus{
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 0 0 4px rgba(59,130,246,.12);
    }
    .out{ margin-top:10px; padding:10px 12px; border-radius:12px; border:1px solid rgba(17,24,39,.10); background: rgba(13,15,22,.031); font-size:12px; color: rgba(13,15,22,.78); }
    .hint{ margin-top:8px; font-size:12px; color:rgba(13,15,22,.65); }
  </style>
</head>
<body>
<div class="wrap">
  <h1>Renditerechner</h1>
  <p class="lead">
    Finde heraus, was heutige Zahlungen zukünftig wert sind und andersherum. Beispiele: Wie entwickelt sich ein Sparbetrag über 5 Jahre (I)? Was ist eine Schenkung in 10 Jahren heute wert (II)? Was kommt bei einem ETF-Sparplan nach 20 Jahren heraus (III)? Was muss ich für meine Ziele monatlich zur Seite legen (IV)? Wieviel kostet mich ein Kredit pro Monat (V)? Beachte, dass die Werte von den Näherugswerten in den Buch-Tabellen abweichen können.
  </p>

  <div class="grid">
    <div class="card">
      <div class="sectionTitle">I: Endwert einer Einmalanlage</div>
      <div class="twoCol">
        <div>
          <label>Einmalanlage heute (€)</label>
          <input id="ci1_pv" type="text" inputmode="decimal" value="10.000">
        </div>
        <div>
          <label>Rendite p.a. (%)</label>
          <input id="ci1_i" type="text" inputmode="decimal" value="5,0">
        </div>
      </div>
      <div style="margin-top:12px;">
        <label>Anlagedauer (Jahre)</label>
        <input id="ci1_n" type="text" inputmode="numeric" value="20">
      </div>
      <div class="out" id="ci1_out">—</div>
    </div>

    <div class="card">
      <div class="sectionTitle">II: Gegenwartswert einer zukünftigen Zahlung</div>
      <div class="twoCol">
        <div>
          <label>Zukünftige Zahlung (€)</label>
          <input id="ci2_fv" type="text" inputmode="decimal" value="50.000">
        </div>
        <div>
          <label>Rendite p.a. (%)</label>
          <input id="ci2_i" type="text" inputmode="decimal" value="5,0">
        </div>
      </div>
      <div style="margin-top:12px;">
        <label>Anlagedauer (Jahre)</label>
        <input id="ci2_n" type="text" inputmode="numeric" value="20">
      </div>
      <div class="out" id="ci2_out">—</div>
    </div>

    <div class="card">
      <div class="sectionTitle">III: Endwert einer monatlichen Zahlungsreihe</div>
      <div class="twoCol">
        <div>
          <label>Monatliche Zahlung zu Beginn (€)</label>
          <input id="ci3_pmt" type="text" inputmode="decimal" value="200">
        </div>
        <div>
          <label>Rendite p.a. (%)</label>
          <input id="ci3_i" type="text" inputmode="decimal" value="5,0">
        </div>
      </div>
      <div class="twoCol" style="margin-top:12px;">
        <div>
          <label>Anlagedauer (Jahre)</label>
          <input id="ci3_n" type="text" inputmode="numeric" value="20">
        </div>
        <div>
          <label>Anstieg der Zahlung p.a. (%)</label>
          <input id="ci3_g" type="text" inputmode="decimal" value="2,0">
        </div>
      </div>
      <div class="out" id="ci3_out">—</div>
    </div>

    <div class="card">
      <div class="sectionTitle">IV: Monatliche Zahlung zur Erreichung eines Endwertes</div>
      <div class="twoCol">
        <div>
          <label>Endwert (€)</label>
          <input id="ci4_fv" type="text" inputmode="decimal" value="100.000">
        </div>
        <div>
          <label>Rendite p.a. (%)</label>
          <input id="ci4_i" type="text" inputmode="decimal" value="5,0">
        </div>
      </div>
      <div class="twoCol" style="margin-top:12px;">
        <div>
          <label>Anlagedauer (Jahre)</label>
          <input id="ci4_n" type="text" inputmode="numeric" value="20">
        </div>
        <div>
          <label>Anstieg der Zahlung p.a. (%)</label>
          <input id="ci4_g" type="text" inputmode="decimal" value="2,0">
        </div>
      </div>
      <div class="out" id="ci4_out">—</div>
    </div>

    <div class="card">
      <div class="sectionTitle">V: Gegenwartswert einer monatlichen Zahlungsreihe</div>
      <div class="twoCol">
        <div>
          <label>Monatliche Zahlung zu Beginn (€)</label>
          <input id="ci5_pmt" type="text" inputmode="decimal" value="200">
        </div>
        <div>
          <label>Rendite p.a. (%)</label>
          <input id="ci5_i" type="text" inputmode="decimal" value="5,0">
        </div>
      </div>
      <div class="twoCol" style="margin-top:12px;">
        <div>
          <label>Anlagedauer (Jahre)</label>
          <input id="ci5_n" type="text" inputmode="numeric" value="20">
        </div>
        <div>
          <label>Anstieg der Zahlung p.a. (%)</label>
          <input id="ci5_g" type="text" inputmode="decimal" value="2,0">
        </div>
      </div>
      <div class="out" id="ci5_out">—</div>
    </div>

  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  const eur0DE = new Intl.NumberFormat("de-DE", {
    style:"currency", currency:"EUR", maximumFractionDigits: 0
  });
  const euro0 = (x) => isFinite(x) ? eur0DE.format(x) : "—";

  function parseDE(s) {
    if (s == null) return NaN;
    let t = String(s).trim();
    if (!t) return NaN;
    t = t.replace(/\s+/g, "");
    if (t.includes(".") && t.includes(",")) {
      t = t.replace(/\./g, "").replace(",", ".");
    } else if (t.includes(",")) {
      t = t.replace(",", ".");
    } else {
      const parts = t.split(".");
      if (parts.length === 2 && parts[1].length === 3 && parts[0].length >= 1) {
        t = parts[0] + parts[1];
      }
    }
    const v = Number(t);
    return isFinite(v) ? v : NaN;
  }

  function formatMoneyField(id) {
    const el = $(id);
    const v = parseDE(el.value);
    if (!isFinite(v)) return;
    el.value = new Intl.NumberFormat("de-DE", { maximumFractionDigits: 0 }).format(Math.round(v));
  }

  function formatPctField(id) {
    const el = $(id);
    const v = parseDE(el.value);
    if (!isFinite(v)) return;
    el.value = new Intl.NumberFormat("de-DE", { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(v);
  }

  function formatIntField(id) {
    const el = $(id);
    const v = parseDE(el.value);
    if (!isFinite(v)) return;
    el.value = String(Math.max(0, Math.round(v)));
  }

  function effMonthlyRate(annualPct) {
    const i = annualPct / 100;
    return Math.pow(1 + i, 1/12) - 1;
  }

 function recalcCI(){
    // I: Endwert Einmalanlage (Monthly compounding for consistency)
    const pv1 = Math.max(0, parseDE($("ci1_pv").value));
    const i1m = effMonthlyRate(Math.max(0, parseDE($("ci1_i").value)));
    const n1  = Math.max(0, Math.round(parseDE($("ci1_n").value))) * 12;
    const fv1 = pv1 * Math.pow(1 + i1m, n1);
    $("ci1_out").innerHTML = `<b>Endwert:</b> ${euro0(Math.round(fv1))}`;

    // II: Gegenwartswert Einmalanlage (Now using monthly rates)
    const fv2 = Math.max(0, parseDE($("ci2_fv").value));
    const i2m = effMonthlyRate(Math.max(0, parseDE($("ci2_i").value)));
    const n2  = Math.max(0, Math.round(parseDE($("ci2_n").value))) * 12;
    const pv2 = (n2 === 0) ? fv2 : (fv2 / Math.pow(1 + i2m, n2));
    $("ci2_out").innerHTML = `<b>Gegenwartswert:</b> ${euro0(Math.round(pv2))}`;

    // III: Endwert Zahlungsreihe
    const pmt3 = Math.max(0, parseDE($("ci3_pmt").value));
    const i3m  = effMonthlyRate(Math.max(0, parseDE($("ci3_i").value)));
    const g3m  = effMonthlyRate(Math.max(0, parseDE($("ci3_g").value)));
    const n3   = Math.max(0, Math.round(parseDE($("ci3_n").value))) * 12;
    let fv3 = 0;
    if (n3 > 0) {
      if (Math.abs(i3m - g3m) < 1e-15) fv3 = pmt3 * n3 * Math.pow(1 + i3m, n3 - 1);
      else fv3 = pmt3 * (Math.pow(1 + i3m, n3) - Math.pow(1 + g3m, n3)) / (i3m - g3m);
    }
    $("ci3_out").innerHTML = `<b>Endwert:</b> ${euro0(Math.round(fv3))}`;

    // IV: Monatliche Zahlung (Goal Seek)
    const fv4 = Math.max(0, parseDE($("ci4_fv").value));
    const i4m = effMonthlyRate(Math.max(0, parseDE($("ci4_i").value)));
    const g4m = effMonthlyRate(Math.max(0, parseDE($("ci4_g").value)));
    const n4  = Math.max(0, Math.round(parseDE($("ci4_n").value))) * 12;
    let pmt4 = 0;
    if (n4 > 0) {
      const denom = (Math.abs(i4m - g4m) < 1e-15) ? (n4 * Math.pow(1 + i4m, n4 - 1)) : (Math.pow(1 + i4m, n4) - Math.pow(1 + g4m, n4)) / (i4m - g4m);
      pmt4 = fv4 / denom;
    }
    $("ci4_out").innerHTML = `<b>Monatliche Zahlung zu Beginn:</b> ${euro0(Math.round(pmt4))}`;

    // V: Gegenwartswert Zahlungsreihe
    const pmt5 = Math.max(0, parseDE($("ci5_pmt").value));
    const i5m  = effMonthlyRate(Math.max(0, parseDE($("ci5_i").value)));
    const g5m  = effMonthlyRate(Math.max(0, parseDE($("ci5_g").value)));
    const n5   = Math.max(0, Math.round(parseDE($("ci5_n").value))) * 12;
    let pv5 = 0;
    if (n5 > 0) {
        // PV calculation derived from the FV of a growing annuity
        let fv5Temp = (Math.abs(i5m - g5m) < 1e-15) 
            ? pmt5 * n5 * Math.pow(1 + i5m, n5 - 1) 
            : pmt5 * (Math.pow(1 + i5m, n5) - Math.pow(1 + g5m, n5)) / (i5m - g5m);
        pv5 = fv5Temp / Math.pow(1 + i5m, n5);
    }
    $("ci5_out").innerHTML = `<b>Gegenwartswert:</b> ${euro0(Math.round(pv5))}`;
  }

  document.querySelectorAll("input").forEach(el => {
    el.addEventListener("input", () => {
      clearTimeout(window.__t);
      window.__t = setTimeout(recalcCI, 80);
    });
  });

  // Blur Events für alle Felder inkl. Karte V
  $("ci1_pv").addEventListener("blur", () => formatMoneyField("ci1_pv"));
  $("ci1_i").addEventListener("blur", () => formatPctField("ci1_i"));
  $("ci1_n").addEventListener("blur", () => formatIntField("ci1_n"));
  $("ci2_fv").addEventListener("blur", () => formatMoneyField("ci2_fv"));
  $("ci2_i").addEventListener("blur", () => formatPctField("ci2_i"));
  $("ci2_n").addEventListener("blur", () => formatIntField("ci2_n"));
  $("ci3_pmt").addEventListener("blur", () => formatMoneyField("ci3_pmt"));
  $("ci3_i").addEventListener("blur", () => formatPctField("ci3_i"));
  $("ci3_g").addEventListener("blur", () => formatPctField("ci3_g"));
  $("ci3_n").addEventListener("blur", () => formatIntField("ci3_n"));
  $("ci4_fv").addEventListener("blur", () => formatMoneyField("ci4_fv"));
  $("ci4_i").addEventListener("blur", () => formatPctField("ci4_i"));
  $("ci4_g").addEventListener("blur", () => formatPctField("ci4_g"));
  $("ci4_n").addEventListener("blur", () => formatIntField("ci4_n"));
  $("ci5_pmt").addEventListener("blur", () => formatMoneyField("ci5_pmt"));
  $("ci5_i").addEventListener("blur", () => formatPctField("ci5_i"));
  $("ci5_g").addEventListener("blur", () => formatPctField("ci5_g"));
  $("ci5_n").addEventListener("blur", () => formatIntField("ci5_n"));

  // Init
  ["ci1_pv","ci2_fv","ci3_pmt","ci4_fv","ci5_pmt"].forEach(formatMoneyField);
  ["ci1_i","ci2_i","ci3_i","ci3_g","ci4_i","ci4_g","ci5_i","ci5_g"].forEach(formatPctField);
  ["ci1_n","ci2_n","ci3_n","ci4_n","ci5_n"].forEach(formatIntField);
  recalcCI();
</script>
</body>
</html>