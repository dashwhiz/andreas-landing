<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Renten- & Vermögensrechner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#ffffff;
      --ink:#111827;
      --muted:#464b5a;

      --card:#ffffff;
      --border:rgba(17,24,39,.10);

      --softBlue:#def1ff;
      --softBlueBorder:#bfe6ff;

      --shadow:0 18px 45px rgba(17,24,39,.10);
      --radius:16px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:26px 18px 48px; }
    h1{ margin:0 0 10px; font-size:22px; letter-spacing:.2px; }
    p.lead{ margin:0 0 18px; color:var(--muted); line-height:1.5; max-width:980px; }

    .topbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin: 10px 0 16px; }
    select, button{
      font: inherit;
      border-radius: 12px;
      border: 1px solid rgba(17,24,39,.14);
      background: #fff;
      color: var(--ink);
      padding: 10px 12px;
      outline: none;
    }
    button.primary{
      background: var(--softBlue);
      border-color: var(--softBlueBorder);
      font-weight: 800;
      cursor: pointer;
    }

    .grid{ display:grid; grid-template-columns:1fr; gap:16px; }
    @media (min-width: 940px){ .grid{ grid-template-columns:1.15fr .85fr; } }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:var(--shadow);
    }
    .callout{
      background:var(--softBlue);
      border:2px solid var(--softBlueBorder);
      border-radius: calc(var(--radius) + 6px);
      padding:16px;
    }

    .sectionTitle{ margin:0 0 10px; font-size:15px; font-weight:900; }
    .subTitle{ margin:14px 0 10px; font-size:13px; color:var(--muted); font-weight:900; letter-spacing:.2px; }

    .twoCol{ display:grid; grid-template-columns:1fr; gap:12px; }
    @media (min-width: 720px){ .twoCol{ grid-template-columns:1fr 1fr; } }

    .field{ display:grid; gap:6px; }
    .labelRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    label{ font-size:13px; color:var(--muted); line-height:1.2; }

    input{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid rgba(17,24,39,.14);
      background:#fff;
      color:var(--ink);
      outline:none;
      transition:border-color .12s ease, box-shadow .12s ease;
    }
    input:focus{
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 0 0 4px rgba(59,130,246,.12);
    }
    input[disabled]{
      background: rgba(17,24,39,.04);
      color: rgba(17,24,39,.70);
      border-color: rgba(17,24,39,.10);
      cursor:not-allowed;
    }

    .info{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:22px; height:22px;
      border-radius:999px;
      border:1px solid rgba(17,24,39,.16);
      background:#fff;
      color: rgba(17,24,39,.70);
      font-weight:900;
      font-size:12px;
      cursor: help;
      flex:0 0 auto;
    }
    .tip{
      position:absolute;
      top: calc(100% + 8px);
      left: 50%;
      transform: translate(-50%, -4px);
      width: min(420px, calc(100vw - 40px));
      max-height: 240px;
      overflow: auto;

      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(17,24,39,.12);
      background: #fff;
      color: rgba(13,15,22,.92);
      box-shadow: 0 18px 45px rgba(17,24,39,.16);

      font-size: 12px;
      line-height: 1.45;
      opacity: 0;
      pointer-events: none;
      transition: opacity .12s ease, transform .12s ease;
      z-index: 50;
      overflow-wrap: anywhere;
      white-space: normal;
    }
    .info:hover .tip{
      opacity:1;
      transform: translate(-50%, 0);
    }

    table{
      width:100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow:hidden;
      border-radius: 14px;
      border: 1px solid rgba(17,24,39,.12);
      background:#fff;
    }
    thead th{
      text-align:left;
      font-size:12px;
      color: var(--muted);
      padding: 10px 12px;
      background: rgba(13,15,22,.02);
      border-bottom: 1px solid rgba(17,24,39,.08);
      font-weight: 900;
    }
    tbody td{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(17,24,39,.06);
      vertical-align: top;
    }
    tbody tr:last-child td{ border-bottom:none; }

    .rowTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-weight: 800;
      font-size: 13px;
      color: rgba(13,15,22,.88);
    }

    .kpi{
      border-radius:14px;
      border:1px solid rgba(17,24,39,.12);
      background:#fff;
      padding:12px;
      margin-bottom:12px;
    }
    .kpi .k{ font-size:12px; color:var(--muted); }
    .kpi .v{ margin-top:6px; font-size:24px; font-weight:900; letter-spacing:.2px; }

    .statusLine{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(17,24,39,.10);
      background: rgba(13,15,22,.031);
      color: rgba(13,15,22,.70);
      font-size:12px;
      line-height:1.45;
    }
    .bad{ color:#b91c1c; }
    .ok{ color:#047857; }
  </style>
</head>

<body>
<div class="wrap">
  <h1>Renten- &amp; Vermögensrechner</h1>
  <p class="lead">
    Dieses Tool erstellt auf Basis deiner Eckdaten und deiner Kontostände Deine Vermögensübersicht und Rentenprognose.
    Es berechnet den Gegenwartswert deiner zukünftigen Sparaktivität und der gesetzlichen Rente und ermittelt daraus
    Gesamtvermögen sowie Gesamtrisiko in Risikoeinheiten (RE). Aus Vermögen und erwarteten Risikoprämien (RP) wird das
    Einkommen in der Rente im mittleren und im schlechten Szenario abgeleitet – jeweils in heutigen Preisen und als
    Prozent heutiger Ausgaben.
  </p>

  <div class="topbar">
    <select id="profil">
      <option value="">Beispiel laden…</option>
      <option value="user">User</option>
      <option value="frida">Frida</option>
      <option value="jana">Jana</option>
      <option value="fred">Fred</option>
      <option value="karin">Karin</option>
      <option value="armin">Armin</option>
      <option value="benno">Benno</option>
      <option value="frank">Frank</option>
    </select>
    <button class="primary" id="btnReset">Zurücksetzen (User)</button>
  </div>

  <div class="grid">
    <!-- INPUTS -->
    <div class="card">
      <div class="sectionTitle">Eingaben</div>

      <div class="subTitle">Eckdaten</div>
      <div class="twoCol">
        <div class="field">
          <div class="labelRow">
            <label>Sicherer Zins (% p.a.)</label>
            <span class="info">i<span class="tip">Mit diesem Zinssatz werden sichere Zahlungen auf- bzw. abgezinst.</span></span>
          </div>
          <input id="rPct" type="number" step="0.5" value="2">
        </div>

        <div class="field">
          <div class="labelRow">
            <label>Prognose Einkommensentwicklung (% p.a.)</label>
            <span class="info">i<span class="tip">Mit dieser Wachstumsrate verändert sich Dein Einkommen pro Jahr im langfristigen Durchschnitt.</span></span>
          </div>
          <input id="gPct" type="number" step="0.5" value="2">
        </div>
      </div>

      <div class="twoCol">
        <div class="field">
          <div class="labelRow">
            <label>Alter aktuell</label>
            <span class="info">i<span class="tip">Dein heutiges Alter.</span></span>
          </div>
          <input id="ageNow" type="number" step="1" value="45">
        </div>

        <div class="field">
          <div class="labelRow">
            <label>Alter Renteneintritt</label>
            <span class="info">i<span class="tip">In diesem Alter hörst Du mit dem Arbeiten auf.</span></span>
          </div>
          <input id="ageRet" type="number" step="1" value="67">
        </div>
      </div>

      <div class="field">
        <div class="labelRow">
          <label>Lebenserwartung</label>
          <span class="info">i<span class="tip">Bis zu diesem Alter sollte Deine Auszahlung reichen. Am besten, Du planst hier einen Puffer von mindestens 5 Jahren ein.</span></span>
        </div>
        <input id="ageLife" type="number" step="1" value="90">
      </div>

      <div class="twoCol">
        <div class="field">
          <div class="labelRow">
            <label>Aktuelles Nettoeinkommen (€/Monat)</label>
            <span class="info">i<span class="tip">Der Betrag, der dir nach Abzügen für Steuern und Sozialversicherung für Ausgaben und Spartätigkeit bleibt.</span></span>
          </div>
          <input id="income" type="number" step="50" value="950">
        </div>

        <div class="field">
          <div class="labelRow">
            <label>Sparquote (%)</label>
            <span class="info">i<span class="tip">Anteil des Nettoeinkommens, der gespart (positiv) oder entspart (negativ) wird.</span></span>
          </div>
          <input id="sPct" type="number" step="0.5" value="10">
        </div>
      </div>

      <div class="twoCol">
        <div class="field">
          <div class="labelRow">
            <label>Abgabensatz auf Renteneinkommen (in %)</label>
            <span class="info">i<span class="tip">Pauschaler Unterschied zwischen Brutto- und Nettoeinkommen in der Rente – also Summe aus Steuern und Kranken- und Pflegeversicherung.</span></span>
          </div>
          <input id="taxPct" type="number" step="0.5" value="25">
        </div>

        <div class="field">
          <div class="labelRow">
            <label>Prognose gesetzliche Rente (€/Monat)</label>
            <span class="info">i<span class="tip">Eingabewert: Rentenauszahlung gemäß letztem Rentenbescheid bei 1% Rentenanpassungsfaktor.</span></span>
          </div>
          <input id="pensionMonthly" type="number" step="50" value="1262">
        </div>
      </div>

      <div class="twoCol">
        <div class="field">
          <div class="labelRow">
            <label>Z-Wert „schlechtes Szenario“</label>
            <span class="info">i<span class="tip">Wahrscheinlichkeit = NORM.S.DIST(Z; WAHR). (Kumulative Standardnormalverteilung)</span></span>
          </div>
          <input id="zBad" type="number" step="0.01" value="-1.04">
        </div>

        <div class="field">
          <div class="labelRow">
            <label>Berechnung</label>
            <span class="info">i<span class="tip">Hier wird die linke Fläche P(Z ≤ z) berechnet (wie in Excel: NORM.S.DIST).</span></span>
          </div>
          <input type="text" value="P(Z ≤ z)" disabled>
        </div>
      </div>

      <div class="subTitle">Vermögensübersicht</div>
      <div class="callout">
        <table>
          <thead>
            <tr>
              <th style="width:44%;">Position</th>
              <th style="width:18%;">Betrag (000€)</th>
              <th style="width:18%;">RE (Skala)</th>
              <th style="width:20%;">RP (%)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><div class="rowTitle"><span>Bankkonten</span><span class="info">i<span class="tip">Kontostand.</span></span></div></td>
              <td><input id="bankK" type="number" step="5" value="50"></td>
              <td><input id="reBank" type="number" step="0.5" value="0"></td>
              <td><input id="rpBankPct" type="number" step="0.5" value="0"></td>
            </tr>

            <tr>
              <td><div class="rowTitle"><span>Altersvorsorge</span><span class="info">i<span class="tip">Aktueller Wert von privaten und betrieblichen Altersvorsorgeverträgen bzw. -zusagen.</span></span></div></td>
              <td><input id="pensionAssetK" type="number" step="5" value="0"></td>
              <td><input id="rePensionAsset" type="number" step="0.5" value="0"></td>
              <td><input id="rpPensionAssetPct" type="number" step="0.5" value="0"></td>
            </tr>

            <tr>
              <td><div class="rowTitle"><span>Wertpapiere</span><span class="info">i<span class="tip">Aktuelle Depotwerte.</span></span></div></td>
              <td><input id="secK" type="number" step="5" value="220"></td>
              <td><input id="reSec" type="number" step="0.5" value="3.5"></td>
              <td><input id="rpSecPct" type="number" step="0.5" value="2"></td>
            </tr>

            <tr>
              <td><div class="rowTitle"><span>Immobilien</span><span class="info">i<span class="tip">Aktueller Schätzwert.</span></span></div></td>
              <td><input id="immoK" type="number" step="5" value="300"></td>
              <td><input id="reImmo" type="number" step="0.5" value="2"></td>
              <td><input id="rpImmoPct" type="number" step="0.5" value="2"></td>
            </tr>

            <tr>
              <td><div class="rowTitle"><span>Kredite</span><span class="info">i<span class="tip">Restschuld (bitte mit Minus-Zeichen).</span></span></div></td>
              <td><input id="debtK" type="number" step="5" value="0"></td>
              <td><input id="reDebt" type="number" step="0.5" value="0"></td>
              <td><input id="rpDebtPct" type="number" step="0.5" value="0"></td>
            </tr>

            <tr>
              <td><div class="rowTitle"><span>Zukünftiges Sparen</span><span class="info">i<span class="tip">Gegenwartswert der künftigen Sparbeiträge (automatisch berechnet). RE und RP können angepasst werden.</span></span></div></td>
              <td><input id="pvSaveK" type="number" step="1" value="0" disabled></td>
              <td><input id="rePvSave" type="number" step="0.5" value="1"></td>
              <td><input id="rpPvSavePct" type="number" step="0.5" value="0"></td>
            </tr>

            <tr>
              <td><div class="rowTitle"><span>Gesetzliche Rente</span><span class="info">i<span class="tip">Heutiger Wert deiner Ansprüche (automatisch berechnet). RE und RP können angepasst werden.</span></span></div></td>
              <td><input id="pvPensK" type="number" step="1" value="0" disabled></td>
              <td><input id="rePvPens" type="number" step="0.5" value="1"></td>
              <td><input id="rpPvPensPct" type="number" step="0.5" value="1"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="statusLine" id="status"></div>
    </div>

    <!-- OUTPUTS -->
    <div class="card">
      <div class="sectionTitle">Ergebnisse</div>

      <div class="kpi">
        <div class="k">Gesamtvermögen heute (in 000€)</div>
        <div class="v" id="outTotalToday">—</div>
      </div>

      <div class="kpi">
        <div class="k">Risikoeinheiten (RE)</div>
        <div class="v" id="outReToday">—</div>
      </div>

      <div class="kpi">
        <div class="k">Risikoprämie (RP)</div>
        <div class="v" id="outRpWeighted">—</div>
      </div>

      <div class="kpi">
        <div class="k">Mittleres Netto (€/Monat)</div>
        <div class="v" id="outNetMid">—</div>
      </div>

      <div class="kpi">
        <div class="k">Mittleres Netto (% Ausgaben heute)</div>
        <div class="v" id="outNetMidPct">—</div>
      </div>

      <div class="kpi">
        <div class="k">Schlechtes Netto (€/Monat)</div>
        <div class="v" id="outNetBad">—</div>
      </div>

      <div class="kpi">
        <div class="k">Schlechtes Netto (% Ausgaben heute)</div>
        <div class="v" id="outNetBadPct">—</div>
      </div>

      <div class="kpi">
        <div class="k">Wahrscheinlichkeit schlechtes Szenario</div>
        <div class="v" id="outProbBad">—</div>
      </div>
    </div>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  const euro0 = (x) => isFinite(x)
    ? new Intl.NumberFormat(undefined, { style:"currency", currency:"EUR", maximumFractionDigits:0 }).format(x)
    : "—";
  const int0 = (x) => isFinite(x) ? Math.round(+x).toString() : "—";
  const oneDec = (x) => isFinite(x) ? (+x).toFixed(1) : "—";

  // Standardnormalverteilung (kumulativ): NORM.S.DIST(z; WAHR)
  function erf(x) {
    const sign = x >= 0 ? 1 : -1;
    x = Math.abs(x);
    const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741;
    const a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
    const t = 1 / (1 + p * x);
    const y = 1 - (((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t) * Math.exp(-x * x);
    return sign * y;
  }
  function normSDist(z) {
    return 0.5 * (1 + erf(z / Math.SQRT2));
  }

  // Default-Profil: USER
  const USER_DEFAULTS = {
    r: 2, g: 2,
    ageNow: 45, ageRet: 67, ageLife: 90,
    income: 950, s: 10,
    tax: 25,
    pensionMonthly: 1262,
    zBad: -1.04, // Beispiel

    bankK: 50, reBank: 0, rpBank: 0,
    pensionAssetK: 0, rePensionAsset: 0, rpPensionAsset: 0,
    secK: 220, reSec: 3.5, rpSec: 2,
    immoK: 300, reImmo: 2, rpImmo: 2,
    debtK: 0, reDebt: 0, rpDebt: 0,

    rePvSave: 1, rpPvSave: 0,
    rePvPens: 1, rpPvPens: 1
  };

  // Frida
  const FRIDA_DEFAULTS = {
    ...USER_DEFAULTS,
    ageRet: 70,
    s: -100
  };

  const EXAMPLES = {
    user: USER_DEFAULTS,
    frida: FRIDA_DEFAULTS,

    jana:  {
      r:2, g:3, ageNow:35, ageRet:67, ageLife:95,
      income:2800, s:10, tax:20, pensionMonthly:2200,
      zBad: -1.555,
      bankK:15, reBank:0, rpBank:0,
      pensionAssetK:25, rePensionAsset:2, rpPensionAsset:1,
      secK:20, reSec:4, rpSec:4,
      immoK:0, reImmo:0, rpImmo:0,
      debtK:-10, reDebt:0, rpDebt:1,
      rePvSave:1, rpPvSave:4,
      rePvPens:1, rpPvPens:1
    },

    fred:  {
      r:2, g:2, ageNow:50, ageRet:70, ageLife:90,
      income:3800, s:10, tax:30, pensionMonthly:1562,
      zBad: -0.739,
      bankK:90, reBank:0, rpBank:0,
      pensionAssetK:120, rePensionAsset:2, rpPensionAsset:2,
      secK:280, reSec:4, rpSec:3,
      immoK:800, reImmo:3, rpImmo:2,
      debtK:-150, reDebt:0, rpDebt:3,
      rePvSave:3, rpPvSave:3,
      rePvPens:1, rpPvPens:1
    },

    karin: {
      r:2, g:2, ageNow:30, ageRet:67, ageLife:95,
      income:1800, s:5, tax:20, pensionMonthly:1908,
      zBad: -1.645,
      bankK:5, reBank:0, rpBank:0,
      pensionAssetK:0, rePensionAsset:0, rpPensionAsset:0,
      secK:0, reSec:0, rpSec:0,
      immoK:0, reImmo:0, rpImmo:0,
      debtK:0, reDebt:0, rpDebt:0,
      rePvSave:1, rpPvSave:2,
      rePvPens:1, rpPvPens:1
    },

    armin: {
      r:2, g:2, ageNow:40, ageRet:67, ageLife:90,
      income:6400, s:25, tax:35, pensionMonthly:3925,
      zBad: -1.405,
      bankK:125, reBank:0, rpBank:0,
      pensionAssetK:40, rePensionAsset:2, rpPensionAsset:1,
      secK:140, reSec:4, rpSec:3.5,
      immoK:0, reImmo:0, rpImmo:0,
      debtK:0, reDebt:0, rpDebt:0,
      rePvSave:2, rpPvSave:3.5,
      rePvPens:1.5, rpPvPens:1
    },

    benno: {
      r:2, g:2, ageNow:55, ageRet:64, ageLife:90,
      income:58333.3333, s:30, tax:40, pensionMonthly:3150,
      zBad: -0.706,
      bankK:200, reBank:0, rpBank:0,
      pensionAssetK:220, rePensionAsset:2, rpPensionAsset:1,
      secK:2500, reSec:7, rpSec:4,
      immoK:5500, reImmo:2.5, rpImmo:3,
      debtK:-2000, reDebt:0, rpDebt:1.5,
      rePvSave:1, rpPvSave:4,
      rePvPens:1, rpPvPens:1
    },

    frank: {
      r:2, g:2, ageNow:60, ageRet:67, ageLife:90,
      income:6200, s:12, tax:35, pensionMonthly:8309,
      zBad: -0.706,
      bankK:210, reBank:0, rpBank:0,
      pensionAssetK:0, rePensionAsset:0, rpPensionAsset:0,
      secK:0, reSec:0, rpSec:0,
      immoK:0, reImmo:0, rpImmo:0,
      debtK:0, reDebt:0, rpDebt:0,
      rePvSave:0.5, rpPvSave:0,
      rePvPens:0.5, rpPvPens:0.5
    }
  };

  function applyState(s){
    $("rPct").value = s.r;
    $("gPct").value = s.g;
    $("ageNow").value = s.ageNow;
    $("ageRet").value = s.ageRet;
    $("ageLife").value = s.ageLife;

    $("income").value = s.income;
    $("sPct").value = s.s;
    $("taxPct").value = s.tax;
    $("pensionMonthly").value = s.pensionMonthly;

    $("zBad").value = s.zBad;

    $("bankK").value = s.bankK; $("reBank").value = s.reBank; $("rpBankPct").value = s.rpBank;
    $("pensionAssetK").value = s.pensionAssetK; $("rePensionAsset").value = s.rePensionAsset; $("rpPensionAssetPct").value = s.rpPensionAsset;
    $("secK").value = s.secK; $("reSec").value = s.reSec; $("rpSecPct").value = s.rpSec;
    $("immoK").value = s.immoK; $("reImmo").value = s.reImmo; $("rpImmoPct").value = s.rpImmo;
    $("debtK").value = s.debtK; $("reDebt").value = s.reDebt; $("rpDebtPct").value = s.rpDebt;

    $("rePvSave").value = s.rePvSave; $("rpPvSavePct").value = s.rpPvSave;
    $("rePvPens").value = s.rePvPens; $("rpPvPensPct").value = s.rpPvPens;

    recalc();
  }

  function readInputs(){
    return {
      r: +$("rPct").value / 100,
      g: +$("gPct").value / 100,
      ageNow: +$("ageNow").value,
      ageRet: +$("ageRet").value,
      ageLife: +$("ageLife").value,

      income: +$("income").value,
      s: +$("sPct").value / 100,
      tax: +$("taxPct").value / 100,
      pensionMonthly: +$("pensionMonthly").value,

      zBad: +$("zBad").value,

      bankK: +$("bankK").value,
      pensionAssetK: +$("pensionAssetK").value,
      secK: +$("secK").value,
      immoK: +$("immoK").value,
      debtK: +$("debtK").value,

      reBank: +$("reBank").value,
      rePensionAsset: +$("rePensionAsset").value,
      reSec: +$("reSec").value,
      reImmo: +$("reImmo").value,
      reDebt: +$("reDebt").value,

      rePvSave: +$("rePvSave").value,
      rePvPens: +$("rePvPens").value,

      rpBankPct: +$("rpBankPct").value,
      rpPensionAssetPct: +$("rpPensionAssetPct").value,
      rpSecPct: +$("rpSecPct").value,
      rpImmoPct: +$("rpImmoPct").value,
      rpDebtPct: +$("rpDebtPct").value,

      rpPvSavePct: +$("rpPvSavePct").value,
      rpPvPensPct: +$("rpPvPensPct").value
    };
  }

  function pvFutureSavings000(x, nWork){
    const g_m = Math.pow(1 + x.g, 1/12) - 1;
    const d_m = Math.pow(1 + x.r + (x.rpPvSavePct/100), 1/12) - 1;

    if (Math.abs(d_m - g_m) < 1e-15) {
      return (x.income * x.s) * (nWork*12) / 1000;
    }
    return (x.income * x.s) *
      (1 - Math.pow((1+g_m)/(1+d_m), nWork*12)) /
      (d_m - g_m) / 1000;
  }

  function pvPension000(x, nWork, nRet){
    return x.pensionMonthly * (nRet*12) /
      Math.pow(1 + x.r + (x.rpPvPensPct/100), nWork) / 1000;
  }

  function recalc(){
    const x = readInputs();
    const nWork = x.ageRet - x.ageNow;
    const nRet  = x.ageLife - x.ageRet;

    const errors = [];
    if (nWork <= 0) errors.push("Alter aktuell muss kleiner als Renteneintrittsalter sein.");
    if (nRet <= 0) errors.push("Lebenserwartung muss größer als Renteneintrittsalter sein.");
    if (!isFinite(x.tax) || x.tax < 0 || x.tax > 1) errors.push("Abgabensatz prüfen (0–100%).");
    if (!isFinite(x.zBad)) errors.push("Z-Wert prüfen.");

    $("status").innerHTML = errors.length
      ? `<span class="bad">${errors.join(" ")}</span>`
      : `<span class="ok">Alles ok.</span>`;
    if (errors.length) return;

    const pvSave000 = pvFutureSavings000(x, nWork);
    const pvPens000 = pvPension000(x, nWork, nRet);

    $("pvSaveK").value = int0(pvSave000);
    $("pvPensK").value = int0(pvPens000);

    const totalToday000 =
      x.bankK + x.pensionAssetK + x.secK + x.immoK + x.debtK + pvSave000 + pvPens000;

    const reToday = (totalToday000 !== 0) ? (
      (x.bankK * x.reBank) +
      (x.pensionAssetK * x.rePensionAsset) +
      (x.secK * x.reSec) +
      (x.immoK * x.reImmo) +
      (x.debtK * x.reDebt) +
      (pvSave000 * x.rePvSave) +
      (pvPens000 * x.rePvPens)
    ) / totalToday000 : 0;

    const rpWeightedDec = (totalToday000 !== 0) ? (
      (x.bankK * (x.rpBankPct/100)) +
      (x.pensionAssetK * (x.rpPensionAssetPct/100)) +
      (x.secK * (x.rpSecPct/100)) +
      (x.immoK * (x.rpImmoPct/100)) +
      (x.debtK * (x.rpDebtPct/100)) +
      (pvSave000 * (x.rpPvSavePct/100)) +
      (pvPens000 * (x.rpPvPensPct/100))
    ) / totalToday000 : 0;

    const wealthAtRet000 = totalToday000 * Math.pow(1 + x.r + rpWeightedDec, nWork);
    const grossRetMonthly = 1000 * (wealthAtRet000 / (nRet*12));

    const netMid = ((1 - x.tax) * grossRetMonthly) / Math.pow(1 + x.r, nWork);
    const netBad = 1000 * (1 - x.tax) * (totalToday000 / nRet / 12);

    const expensesToday = x.income * (1 - x.s);
    const netMidPct = (expensesToday !== 0) ? (netMid / expensesToday) : NaN;
    const netBadPct = (expensesToday !== 0) ? (netBad / expensesToday) : NaN;

    const probBad = normSDist(x.zBad);

    $("outTotalToday").textContent = int0(totalToday000);
    $("outReToday").textContent = oneDec(reToday);
    $("outRpWeighted").textContent = oneDec(rpWeightedDec * 100) + " %";

    $("outNetMid").textContent = euro0(netMid);
    $("outNetMidPct").textContent = isFinite(netMidPct) ? oneDec(netMidPct*100) + " %" : "—";

    $("outNetBad").textContent = euro0(netBad);
    $("outNetBadPct").textContent = isFinite(netBadPct) ? oneDec(netBadPct*100) + " %" : "—";

    $("outProbBad").textContent = oneDec(probBad * 100) + " %";
  }

  // Auto-Update
  document.querySelectorAll("input").forEach(el => {
    el.addEventListener("input", () => {
      clearTimeout(window.__t);
      window.__t = setTimeout(recalc, 80);
    });
  });

  // Reset: immer auf USER
  $("btnReset").addEventListener("click", () => applyState(USER_DEFAULTS));

  // Beispiele laden
  $("profil").addEventListener("change", (e) => {
    const key = e.target.value;
    if (!key) return;
    applyState(EXAMPLES[key] || USER_DEFAULTS);
    e.target.value = "";
  });

  // Initial: USER ist Default
  applyState(USER_DEFAULTS);
</script>
</body>
</html>
